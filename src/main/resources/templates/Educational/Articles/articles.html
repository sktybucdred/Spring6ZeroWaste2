<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Articles</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <link rel="stylesheet"
          href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <link th:href="@{styles/main.css}" rel="stylesheet"/></head>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<body class="d-flex flex-column h-100">
<div th:replace="~{fragments/header :: header}"></div>

<div class="container">
    <h1 class="my-4">Articles</h1>

    <!-- Link to Create New Article -->
    <a th:href="@{/articles/new}" class="btn btn-primary mb-3">Create New Article</a>

    <!-- Filter by Category and Title-->
    <form method="get" th:action="@{/articles}" class="form-inline mb-3">
        <div class="form-group mr-3">
            <label for="category" class="mr-2">Filter by Category:</label>
            <select name="category" id="category" class="form-control mr-2">
                <option value="" th:selected="${selectedCategory == null}">All</option>
                <option th:each="cat : ${categories}"
                        th:value="${cat}"
                        th:text="${cat}"
                        th:selected="${cat == selectedCategory}">
                    Category
                </option>
            </select>
            <button type="submit" class="btn btn-secondary">Filter</button>
        </div>
    </form>
    <!-- Filter by Title mozna dodac dynamiczne szukanie-->
    <form method="get" th:action="@{/articles}" class="form-inline mb-3">
        <div class="form-group mr-3">
            <label for="title" class="mr-2">Filter by Title:</label>
            <input type="text" name="title" id="title" class="form-control mr-2"
                   th:value="${title}" placeholder="Enter Title"/>
        <button type="submit" class="btn btn-secondary">Filter</button>
        </div>
    </form>
    <!-- Search by Tag -->
    <form method="get" th:action="@{/articles}" class="form-inline mb-3">
        <label for="tagName" class="mr-2">Search by Tag:</label>
        <input type="text" name="tagName" id="tagName" class="form-control mr-2" th:value="${selectedTagName}" placeholder="Enter Tag"/>
        <button type="submit" class="btn btn-secondary">Search</button>
    </form>

    <!-- Articles List -->
    <div>
        <ul class="list-group">
            <li th:each="article : ${articlePage.content}" class="list-group-item">
                <h5 th:text="${article.title}">Article Title</h5>
                <p th:text="${#strings.abbreviate(article.content, 200)} + '...'">Article Content</p>
                <a th:href="@{/articles/{id}(id=${article.id})}" class="btn btn-link">Read More</a>
                <a th:href="@{/articles/edit/{id}(id=${article.id})}" class="btn btn-secondary btn-sm">Edit</a>
                <a th:href="@{/articles/delete/{id}(id=${article.id})}"
                   class="btn btn-danger btn-sm"
                   onclick="return confirm('Are you sure you want to delete this article?');">Delete</a>
            </li>
        </ul>
    </div>

    <!-- Pagination Controls -->
    <nav aria-label="Page navigation example" class="mt-4">
        <ul class="pagination">
            <li class="page-item" th:if="${articlePage.hasPrevious()}">
                <a class="page-link" th:href="@{/articles(page=${articlePage.number - 1}, size=${articlePage.size}, category=${selectedCategory})}" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            <li class="page-item" th:each="i : ${#numbers.sequence(0, articlePage.totalPages - 1)}"
                th:classappend="${i == articlePage.number} ? ' active'">
                <a class="page-link" th:href="@{/articles(page=${i}, size=${articlePage.size}, category=${selectedCategory})}" th:text="${i + 1}">1</a>
            </li>
            <li class="page-item" th:if="${articlePage.hasNext()}">
                <a class="page-link" th:href="@{/articles(page=${articlePage.number + 1}, size=${articlePage.size}, category=${selectedCategory})}" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
        </ul>
    </nav>
</div>

<div th:replace="~{fragments/footer :: footer}"></div>

</body>
</html>
